<Window x:Class="WallpaperApp.TrayApp.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:WallpaperApp.TrayApp.Converters"
        xmlns:models="clr-namespace:WallpaperApp.Models;assembly=WallpaperApp"
        Title="Wallpaper Sync - Settings"
        Width="700" Height="850"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:FitModeToStringConverter x:Key="FitModeToStringConverter"/>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Preview -->
                <RowDefinition Height="Auto"/>  <!-- Image Source -->
                <RowDefinition Height="Auto"/>  <!-- URL/File Input -->
                <RowDefinition Height="Auto"/>  <!-- Refresh Interval -->
                <RowDefinition Height="Auto"/>  <!-- Fit Mode -->
                <RowDefinition Height="Auto"/>  <!-- Action Buttons -->
            </Grid.RowDefinitions>

            <!-- Monitor-Style Preview -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock Text="Preview" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

                <!-- Monitor Frame -->
                <Border Background="#2D2D30" Padding="15" CornerRadius="5">
                    <Border Background="#1E1E1E" BorderBrush="#007ACC" BorderThickness="3" CornerRadius="3">
                        <!-- Preview Container with aspect ratio matching actual monitor -->
                        <Grid Width="{Binding PreviewWidth}" Height="{Binding PreviewHeight}">
                            <!-- Background -->
                            <Rectangle Fill="#000000"/>

                            <!-- Image Preview -->
                            <Image Source="{Binding PreviewImage}" Stretch="{Binding PreviewStretch}"/>

                            <!-- Placeholder when no image -->
                            <TextBlock Text="Select an image source to see preview"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      Foreground="#666666"
                                      FontSize="14"
                                      Visibility="{Binding PreviewImage, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </Grid>
                    </Border>
                </Border>

                <!-- Monitor Stand -->
                <Grid Width="100" Height="30" Margin="0,2,0,0">
                    <Rectangle Fill="#2D2D30" RadiusX="3" RadiusY="3" Margin="0,0,0,10"/>
                    <Rectangle Fill="#2D2D30" Width="40" Height="10" VerticalAlignment="Bottom"/>
                </Grid>

                <!-- Status Text -->
                <TextBlock Text="{Binding PreviewStatus}"
                          Foreground="Gray"
                          FontSize="11"
                          HorizontalAlignment="Center"
                          Margin="0,5,0,0"/>

                <!-- Screen Resolution Info -->
                <TextBlock HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="Gray" FontSize="10">
                    <Run Text="Your screen: "/>
                    <Run Text="{Binding ScreenWidth, StringFormat={}{0:F0}}"/>
                    <Run Text=" × "/>
                    <Run Text="{Binding ScreenHeight, StringFormat={}{0:F0}}"/>
                    <Run Text=" pixels"/>
                </TextBlock>
            </StackPanel>

            <!-- Image Source Selection -->
            <StackPanel Grid.Row="1" Margin="0,0,0,15">
                <TextBlock Text="Image Source" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                <StackPanel Orientation="Horizontal">
                    <RadioButton Content="URL" IsChecked="{Binding IsUrlMode}"
                                 Command="{Binding SelectUrlModeCommand}" Margin="0,0,20,0"/>
                    <RadioButton Content="Local File" IsChecked="{Binding IsLocalFileMode}"
                                 Command="{Binding SelectLocalFileModeCommand}"/>
                </StackPanel>
            </StackPanel>

            <!-- URL/File Path Input -->
            <StackPanel Grid.Row="2" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- URL Mode -->
                    <TextBox Text="{Binding ImageUrl, UpdateSourceTrigger=PropertyChanged}"
                             Visibility="{Binding IsUrlMode, Converter={StaticResource BoolToVisibilityConverter}}"
                             Margin="0,0,10,0" Height="25"/>

                    <!-- Local File Mode -->
                    <TextBox Text="{Binding LocalImagePath}"
                             IsReadOnly="True"
                             Visibility="{Binding IsLocalFileMode, Converter={StaticResource BoolToVisibilityConverter}}"
                             Margin="0,0,10,0" Height="25"/>

                    <Button Content="Browse..." Grid.Column="1"
                            Command="{Binding BrowseCommand}"
                            Visibility="{Binding IsLocalFileMode, Converter={StaticResource BoolToVisibilityConverter}}"
                            Padding="15,5" Height="25"/>
                </Grid>

                <!-- Validation Error -->
                <TextBlock Text="{Binding UrlValidationError}"
                           Foreground="Red"
                           FontWeight="Bold"
                           Visibility="{Binding UrlValidationError, Converter={StaticResource NullToVisibilityConverter}}"
                           Margin="0,5,0,0"/>
            </StackPanel>

            <!-- Refresh Interval -->
            <StackPanel Grid.Row="3" Margin="0,0,0,15">
                <TextBlock Text="Refresh Interval" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                <ComboBox ItemsSource="{Binding IntervalPresets}"
                          SelectedItem="{Binding SelectedIntervalPreset}" Height="25"
                          DisplayMemberPath="DisplayName"/>

                <!-- Custom Interval Input -->
                <Grid Margin="0,10,0,0"
                      Visibility="{Binding IsCustomIntervalSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="120"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Custom: " VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox Grid.Column="1" Text="{Binding CustomIntervalValue, UpdateSourceTrigger=PropertyChanged}"
                             Height="25" VerticalContentAlignment="Center"/>
                    <ComboBox Grid.Column="3" SelectedItem="{Binding CustomIntervalUnit}" Height="25" Margin="10,0,0,0">
                        <ComboBoxItem Content="Minutes"/>
                        <ComboBoxItem Content="Hours"/>
                    </ComboBox>
                </Grid>

                <TextBlock Margin="0,5,0,0" Foreground="Gray" FontSize="11">
                    <Run Text="ⓘ How often to automatically change your wallpaper (minimum: 1 minute)"/>
                </TextBlock>
            </StackPanel>

            <!-- Layout Selector -->
            <StackPanel Grid.Row="4" Margin="0,0,0,15">
                <TextBlock Text="Wallpaper Layout" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                <ComboBox SelectedItem="{Binding SelectedFitMode}" Height="25">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Converter={StaticResource FitModeToStringConverter}}"/>
                                <TextBlock Text=" (Recommended)" Foreground="Green" FontWeight="Bold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding}" Value="{x:Static models:WallpaperFitMode.Fit}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                    <ComboBox.Items>
                        <x:Static Member="models:WallpaperFitMode.Fit"/>
                        <x:Static Member="models:WallpaperFitMode.Fill"/>
                        <x:Static Member="models:WallpaperFitMode.Stretch"/>
                        <x:Static Member="models:WallpaperFitMode.Tile"/>
                        <x:Static Member="models:WallpaperFitMode.Center"/>
                    </ComboBox.Items>
                </ComboBox>
                <TextBlock Margin="0,5,0,0" Foreground="Gray" FontSize="11">
                    <Run Text="ⓘ How the image is displayed: Fit shows entire image; Fill crops to avoid black bars; Stretch may distort"/>
                </TextBlock>
            </StackPanel>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="5" Orientation="Horizontal"
                        HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="Preview Image" Command="{Binding TestWallpaperCommand}"
                        Margin="0,0,10,0" Padding="15,8" Height="35"/>
                <Button Content="Undo Changes" Command="{Binding ResetToDefaultsCommand}"
                        Margin="0,0,10,0" Padding="15,8" Height="35"/>
                <Button Content="Cancel" Command="{Binding CancelCommand}"
                        Margin="0,0,10,0" Padding="15,8" Height="35"/>
                <Button Content="Save" Command="{Binding SaveCommand}"
                        Padding="20,8" FontWeight="Bold" Height="35"/>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Window>
