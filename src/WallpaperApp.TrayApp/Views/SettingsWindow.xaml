<Window x:Class="WallpaperApp.TrayApp.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:WallpaperApp.TrayApp.Converters"
        xmlns:models="clr-namespace:WallpaperApp.Models;assembly=WallpaperApp"
        Title="Wallpaper Sync - Settings"
        Width="550" Height="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:FitModeToStringConverter x:Key="FitModeToStringConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Image Source Selection -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="Image Source" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
            <StackPanel Orientation="Horizontal">
                <RadioButton Content="URL" IsChecked="{Binding IsUrlMode, Mode=OneWay}"
                             Command="{Binding SelectUrlModeCommand}" Margin="0,0,20,0"/>
                <RadioButton Content="Local File" IsChecked="{Binding IsLocalFileMode, Mode=OneWay}"
                             Command="{Binding SelectLocalFileModeCommand}"/>
            </StackPanel>
        </StackPanel>

        <!-- URL/File Path Input -->
        <StackPanel Grid.Row="1" Margin="0,20,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- URL Mode -->
                <TextBox Text="{Binding ImageUrl, UpdateSourceTrigger=PropertyChanged}"
                         Visibility="{Binding IsUrlMode, Converter={StaticResource BoolToVisibilityConverter}}"
                         Margin="0,0,10,0" Height="25"/>

                <!-- Local File Mode -->
                <TextBox Text="{Binding LocalImagePath}"
                         IsReadOnly="True"
                         Visibility="{Binding IsLocalFileMode, Converter={StaticResource BoolToVisibilityConverter}}"
                         Margin="0,0,10,0" Height="25"/>

                <Button Content="Browse..." Grid.Column="1"
                        Command="{Binding BrowseCommand}"
                        Visibility="{Binding IsLocalFileMode, Converter={StaticResource BoolToVisibilityConverter}}"
                        Padding="15,5" Height="25"/>
            </Grid>

            <!-- Hint Text -->
            <TextBlock Margin="0,5,0,0" Foreground="Gray" FontSize="11">
                <Run Text="ⓘ "/>
                <Run Text="{Binding IsUrlMode, Converter={StaticResource BoolToVisibilityConverter},
                     ConverterParameter='Enter HTTPS URL or select local image', FallbackValue='Enter HTTPS URL'}"/>
            </TextBlock>

            <!-- Validation Error -->
            <TextBlock Text="{Binding UrlValidationError}"
                       Foreground="Red"
                       FontWeight="Bold"
                       Visibility="{Binding UrlValidationError, Converter={StaticResource NullToVisibilityConverter}}"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Refresh Interval Slider -->
        <StackPanel Grid.Row="2" Margin="0,20,0,0">
            <TextBlock Text="Refresh Interval (minutes)" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBox Text="{Binding RefreshIntervalMinutes, UpdateSourceTrigger=PropertyChanged}"
                         Width="60" Height="25" VerticalContentAlignment="Center"/>
                <Slider Grid.Column="1" Minimum="1" Maximum="1440"
                        Value="{Binding RefreshIntervalMinutes}"
                        TickFrequency="15" IsSnapToTickEnabled="True"
                        Margin="10,0,0,0" VerticalAlignment="Center"/>
            </Grid>
        </StackPanel>

        <!-- Fit Mode Selector -->
        <StackPanel Grid.Row="3" Margin="0,20,0,0">
            <TextBlock Text="Wallpaper Fit Mode" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
            <ComboBox SelectedItem="{Binding SelectedFitMode}" Height="25">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Converter={StaticResource FitModeToStringConverter}}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
                <ComboBox.Items>
                    <x:Static Member="models:WallpaperFitMode.Fill"/>
                    <x:Static Member="models:WallpaperFitMode.Fit"/>
                    <x:Static Member="models:WallpaperFitMode.Stretch"/>
                    <x:Static Member="models:WallpaperFitMode.Tile"/>
                    <x:Static Member="models:WallpaperFitMode.Center"/>
                </ComboBox.Items>
            </ComboBox>
            <TextBlock Margin="0,5,0,0" Foreground="Gray" FontSize="11">
                <Run Text="ⓘ "/>
                <Run Text="How the image fits your screen"/>
            </TextBlock>
        </StackPanel>

        <!-- Preview Placeholder -->
        <Border Grid.Row="4" BorderBrush="#CCC" BorderThickness="1"
                Margin="0,20,0,0" Background="#F5F5F5">
            <TextBlock Text="Preview" HorizontalAlignment="Center"
                       VerticalAlignment="Center" Foreground="#999" FontSize="16"/>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal"
                    HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Test Wallpaper" Command="{Binding TestWallpaperCommand}"
                    Margin="0,0,10,0" Padding="15,8" Height="35"/>
            <Button Content="Reset" Command="{Binding ResetToDefaultsCommand}"
                    Margin="0,0,10,0" Padding="15,8" Height="35"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}"
                    Margin="0,0,10,0" Padding="15,8" Height="35"/>
            <Button Content="Save" Command="{Binding SaveCommand}"
                    Padding="20,8" FontWeight="Bold" Height="35"/>
        </StackPanel>
    </Grid>
</Window>
