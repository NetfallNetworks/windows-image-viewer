<?xml version="1.0" encoding="utf-8"?>
<!--
  Sparse MSIX Identity Package for Wallpaper Sync Widget Provider.

  This manifest provides package identity for the WallpaperApp.WidgetProvider.exe
  COM server so that the Windows 11 Widget Board can activate and display the widget.

  The sparse package does NOT contain the executable — AllowExternalContent="true"
  tells Windows to look for the exe at the path registered via ExternalLocationUri
  during AddPackageByUriAsync().

  See ADR-007 for the architectural decision and trade-off analysis.
-->
<Package
  xmlns="http://schemas.microsoft.com/appx/manifest/foundation/windows10"
  xmlns:uap="http://schemas.microsoft.com/appx/manifest/uap/windows10"
  xmlns:uap3="http://schemas.microsoft.com/appx/manifest/uap/windows10/3"
  xmlns:uap10="http://schemas.microsoft.com/appx/manifest/uap/windows10/10"
  xmlns:com="http://schemas.microsoft.com/appx/manifest/com/windows10"
  xmlns:rescap="http://schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities"
  IgnorableNamespaces="uap uap3 uap10 com rescap">

  <Identity
    Name="WallpaperSync.WidgetProvider"
    Publisher="CN=WallpaperSync"
    Version="1.0.0.0"
    ProcessorArchitecture="x64" />

  <Properties>
    <DisplayName>Wallpaper Sync Widget</DisplayName>
    <PublisherDisplayName>WallpaperSync</PublisherDisplayName>
    <Logo>Assets\StoreLogo.png</Logo>
    <!-- AllowExternalContent lets the manifest reference an exe installed outside the package -->
    <uap10:AllowExternalContent>true</uap10:AllowExternalContent>
  </Properties>

  <Dependencies>
    <TargetDeviceFamily Name="Windows.Desktop" MinVersion="10.0.19041.0" MaxVersionTested="10.0.22621.0" />
  </Dependencies>

  <Resources>
    <Resource Language="en-us" />
  </Resources>

  <Applications>
    <Application Id="WallpaperSyncWidgetProvider"
                 Executable="WallpaperApp.WidgetProvider.exe"
                 EntryPoint="Windows.FullTrustApplication">

      <!-- uap:VisualElements (not uap3) — AppListEntry="none" hides from Start menu -->
      <uap:VisualElements
        DisplayName="Wallpaper Sync"
        Description="Displays your Wallpaper Sync image in the Widget Board"
        BackgroundColor="transparent"
        AppListEntry="none"
        Square44x44Logo="Assets\Square44x44Logo.png"
        Square150x150Logo="Assets\Square150x150Logo.png" />

      <Extensions>
        <!-- COM server registration: Widget Board activates this CLSID to create the provider -->
        <com:Extension Category="windows.comServer">
          <com:ComServer>
            <com:ExeServer
              Executable="WallpaperApp.WidgetProvider.exe"
              Arguments="-RegisterProcessAsComServer"
              DisplayName="Wallpaper Sync Widget Provider">
              <com:Class Id="6B2A4C8E-3F1D-4A9B-8E2C-5D7F1A3B6E4C"
                         DisplayName="WallpaperImageWidgetProvider" />
            </com:ExeServer>
          </com:ComServer>
        </com:Extension>

        <!-- Widget definition: declares the widget for the Win+W "Add widgets" panel -->
        <uap3:Extension Category="windows.appExtension">
          <uap3:AppExtension
            Name="com.microsoft.windows.widgets"
            DisplayName="Wallpaper Sync"
            Id="WallpaperSync.Widget"
            PublicFolder="Public">
            <uap3:Properties>
              <WidgetProvider>
                <ProviderIcons>
                  <Icon Path="WidgetAssets\WidgetIcon.png" />
                </ProviderIcons>
                <Activation>
                  <CreateInstance ClassId="6B2A4C8E-3F1D-4A9B-8E2C-5D7F1A3B6E4C" />
                </Activation>
                <Definitions>
                  <Definition
                    Id="WallpaperSync_Image"
                    DisplayName="Wallpaper Sync"
                    Description="Shows your synchronized wallpaper image"
                    AllowMultiple="false">
                    <Capabilities>
                      <Capability>
                        <Size Name="small" />
                      </Capability>
                      <Capability>
                        <Size Name="medium" />
                      </Capability>
                      <Capability>
                        <Size Name="large" />
                      </Capability>
                    </Capabilities>
                    <ThemeResources>
                      <Icons>
                        <Icon Path="WidgetAssets\WidgetIcon.png" />
                      </Icons>
                      <Screenshots>
                        <Screenshot Path="WidgetAssets\WidgetScreenshotLight.png"
                                    DisplayAltText="Wallpaper Sync widget preview" />
                      </Screenshots>
                      <DarkMode>
                        <Icons>
                          <Icon Path="WidgetAssets\WidgetIcon.png" />
                        </Icons>
                        <Screenshots>
                          <Screenshot Path="WidgetAssets\WidgetScreenshotDark.png"
                                      DisplayAltText="Wallpaper Sync widget preview (dark)" />
                        </Screenshots>
                      </DarkMode>
                      <LightMode>
                        <Icons>
                          <Icon Path="WidgetAssets\WidgetIcon.png" />
                        </Icons>
                        <Screenshots>
                          <Screenshot Path="WidgetAssets\WidgetScreenshotLight.png"
                                      DisplayAltText="Wallpaper Sync widget preview (light)" />
                        </Screenshots>
                      </LightMode>
                    </ThemeResources>
                  </Definition>
                </Definitions>
              </WidgetProvider>
            </uap3:Properties>
          </uap3:AppExtension>
        </uap3:Extension>
      </Extensions>
    </Application>
  </Applications>

  <Capabilities>
    <rescap:Capability Name="runFullTrust" />
  </Capabilities>
</Package>
